<!DOCTYPE html>
<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400;1,600&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/style.css">


<title>TLV the Type Length Vector Protocol</title>

<script>(function(c,a){if(!a.__SV){var b=window;try{var d,m,j,k=b.location,f=k.hash;d=function(a,b){return(m=a.match(RegExp(b+"=([^&]*)")))?m[1]:null};f&&d(f,"state")&&(j=JSON.parse(decodeURIComponent(d(f,"state"))),"mpeditor"===j.action&&(b.sessionStorage.setItem("_mpcehash",f),history.replaceState(j.desiredHash||"",c.title,k.pathname+k.search)))}catch(n){}var l,h;window.mixpanel=a;a._i=[];a.init=function(b,d,g){function c(b,i){var a=i.split(".");2==a.length&&(b=b[a[0]],i=a[1]);b[i]=function(){b.push([i].concat(Array.prototype.slice.call(arguments,
0)))}}var e=a;"undefined"!==typeof g?e=a[g]=[]:g="mixpanel";e.people=e.people||[];e.toString=function(b){var a="mixpanel";"mixpanel"!==g&&(a+="."+g);b||(a+=" (stub)");return a};e.people.toString=function(){return e.toString(1)+".people (stub)"};l="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
for(h=0;h<l.length;h++)c(e,l[h]);var f="set set_once union unset remove delete".split(" ");e.get_group=function(){function a(c){b[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));e.push([d,call2])}}for(var b={},d=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<f.length;c++)a(f[c]);return b};a._i.push([b,d,g])};a.__SV=1.2;b=c.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?
MIXPANEL_CUSTOM_LIB_URL:"file:"===c.location.protocol&&"//cdn4.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn4.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn4.mxpnl.com/libs/mixpanel-2-latest.min.js";d=c.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d)}})(document,window.mixpanel||[]);
mixpanel.init("bc05040913854909c46ba8408397cdb5", {batch_requests: true})</script>


<body><header class="container bg-white">
  <nav class="navbar navbar-expand-lg navbar-light">

    <a class="navbar-brand text-muted text-monospace" href="/"><span claa="h1">rusty eddy:</span></a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
      <nav class="navbar-nav w-100 justify-content-end">
	<div class="nav w-100">
  	  <a class="nav-link" href="/iot/"> iot &nbsp</a>
  	  <a class="nav-link" href="/notes"> notes &nbsp</a>
  	  <a class="nav-link" href="/software"> software &nbsp</a> 
  	  <a class="nav-link" href="/resume"> resume &nbsp</a> 
  	  <a class="nav-link" href="/about"> about &nbsp</a> 
	</div>
      </nav>
    </div>
  </nav>
</header>
<div class="jumbotron border-top border-bottom bg-white" >
  <div class="row">
    <div class="col-md"></div>
    <div class="col-md-8 text-center">
      <h1 class="header h2 pb-1">TLV the Type Length Vector Protocol</h1>
      <p class="leadin align-right text-muted text-center mt-0">
        A very simple byte oriented protocol used to swap unformatted messages over a variety of communication channels (i2c, SPI, UDP, TCP, RF, BLT, etc).

      </p>
    </div>
    <div class="col-md"></div>
  </div>

  <div class="row text-center smaller-text">
    <div class="col"></div>
    <div class="col-8">
      <nav class="nav justify-content-center">
        
        
        
        
        
      </nav>

    </div>
    <div class="col"></div>
  </div>
</div>
<div id="main body">
<div class="container"><div class="row">
    <div class="col"></div>
    <div class="col-md-8 hero-text">
	<article class="article">
	  <p>TLV is a very simple communication protocol that can be used to send
messages around a complex, distributed system.</p>
<p>The TLV protocol provides only message formatting by definition.  How
the application handles said messages is up to the application, that
is NO assumptions or gaurauntees about losing message, parts of
messages, ordering or retransmission.</p>
<p>If any of these more advanced capabilities are to be provided, they
must be done so at the application layer (so to speak).</p>
<h3 id="generic-underlying-transports">Generic Underlying Transports</h3>
<p>The underlying physical and mac layers will have a huge effect on the
possibility of packet loss, ordering, delay and possible bandwidth.
Each of the communicaiton mediums we use, we will post a comparison of
characteristics, bandwidth, delay and reliability amoung other
things.</p>
<h2 id="tlv-and-tlstring">TLV and TLString</h2>
<p>Type, Length Vector (Value) is as old as the hills, but still just as
useful!  Type length Vector is byte oriented, with three types of
messages: compact (1 byte), short (2 bytes) and full (up to 0xffff
size).</p>
<pre tabindex="0"><code>+--------+--------+--------+--------+
|  Type  | Length | Value  ...
+--------+--------+--------+--------+
</code></pre><p>The first byte is the type of message, the second byte is the length
of the message, inclusive, that is the 2 bytes of the Tyte and Length
field are INCLUDED in the Length of the message.</p>
<h3 id="compact-messages">Compact Messages</h3>
<p>The nature of many types of communication are just quick short
messages that only require a single byte, which not only determines
the <em>type</em> of message, it also supplies <em>no payload</em> beyond the type.</p>
<p>In this case, TLV supports the message type <strong>compact</strong> or
<strong>1-byte</strong>.</p>
<h3 id="short-messages">Short Messages</h3>
<p>In a similar vein, some types my contain only a single value, for
example a sensor value between 0 &amp; 0xff can be advertised with only
two bytes.</p>
<p>Normally, a two byte message: 1-byte for type and 1 byte for the
length would require a 3rd byte for the value.  Hence, that makes the
two byte message unused.</p>
<p>To that end, we provide a 2nd small optimization: Short messages
support the message type and a message value between 0x0 and 0xff in
the length field, thus reducing the <em>Short Message</em> from 3 bytes to 2
bytes.</p>
<h3 id="distinguishing-compact-short-and-normal-packets">Distinguishing Compact, Short and Normal Packets</h3>
<p>The packet types can be identified by the first two bytes of the type
field.  Compact packets always have the first two bits of the type
set:</p>
<h4 id="compact-packets">Compact Packets</h4>
<pre tabindex="0"><code>+--------+
|11xxxxxx|
+--------+
</code></pre><p>Compact packets are a single byte in the <strong>range of 0xC0 to 0xFF</strong>,
depending on how the remaining 2^6 bits are set.</p>
<h4 id="short-packets">Short Packets</h4>
<pre tabindex="0"><code>+--------+--------+
|10xxxxxx| Value  |
+--------+--------+
</code></pre><h4 id="reserved-packets">Reserved Packets</h4>
<pre tabindex="0"><code>+--------+--------+
|01xxxxxx| Value  |
+--------+--------+

The reserved range can be associated with the Short or Regular packet
types is one type is getting used up quicker than another.
</code></pre><p>Short packets are two bytes, with the type value in the range of 0x80
to 0xBF.  Again, short packets have (2^6 = 32)  independent types.</p>
<h4 id="regular-packets">Regular Packets</h4>
<pre tabindex="0"><code>+--------+--------+--------+--------+
|00  Type  | Length | Value  ...
+--------+--------+--------+--------+
</code></pre><p>If desired, the compact and short packets can be turned off,
altogether allocating the entire 2^8 == 256 types to be regular
messages.</p>
	</article>
    </div>
    <div class="col"></div>
</div>
</div>


	</div><footer id="footer" class="container-fluid footer small-text pt-4 border-top">
  <section class="row">
    <div class="col"></div>
    <div class="col text-right">
      <div class="address">419 Main St. #439</div>
      <div class="city">Huntington Beach, CA. 92648</div>
    </div>
    <div class="col-3 text-center">
      <div>
        Last update ~
        
	
        Wednesday, Apr 17, 2019
	
        
      </div>
      <div>site by <a href="/">Eddy Consulting, LLC.</a> ~ &#xA9; 2008 to 2020 </div>
    </div>
    <div class="col">
      <div class="text-left">
	<div class="phone">(714) 362-5402</div>
	<a href="https://github.com/rustyeddy">github</a> .
	<a href="https://twitter.com/rustyeddy">twitter</a> .
	<a href="https://linkedin.com/rustyeddy">linkedin</a><br/>	    
      </div>
    </div>
    <div class="col"></div>
  </section>
</footer>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-19940083-13"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-19940083-13');
</script>


<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>




    </body>
</html>
